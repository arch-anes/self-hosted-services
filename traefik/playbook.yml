---
- name: Start Traefik in docker
  hosts: all
  gather_facts: no

  vars_files:
    - ../common_vars.yml
  vars:
    docker_compose_location: "{{remote_project_location}}/traefik"
  environment:
    DOMAIN_NAME: "{{domain_name}}"

  tasks:
    - name: Create ACME file
      file:
        path: "{{docker_compose_location}}/acme.json"
        mode: 0600
        state: touch

    - name: Create reverse proxy network
      docker_network:
        name: reverse_proxy

    - name: Start Traefik
      docker_compose:
        pull: yes
        project_src: "{{docker_compose_location}}"
