- name: "Create {{stack_display_name}} stack directory"
  file:
    path: "{{storage}}/{{stack_name}}/{{(subfolder is mapping) | ternary((subfolder | first), subfolder)}}"
    state: directory
    owner: "{{(subfolder is mapping) | ternary(subfolder[(subfolder | first)], 1000)}}"
    group: "{{(subfolder is mapping) | ternary(subfolder[(subfolder | first)], 1000)}}"
  become: yes
  loop: "{{subfolders}}"
  loop_control:
    loop_var: "subfolder"
