# code: language=ansible
---

- name: "Install {{ package_file | basename }} Helm package"
  block:
    - set_fact:  # noqa unnamed-task
        package_info: "{{ lookup('file', package_file) | from_yaml }}"

    - community.kubernetes.helm_repository:  # noqa unnamed-task
        name: "{{ package_info['repo']['name'] }}"
        repo_url: "{{ package_info['repo']['repo_url'] }}"

    - community.kubernetes.helm:  # noqa unnamed-task
        name: "{{ package_info['package']['name'] }}"
        namespace: "{{ package_info['package']['namespace'] }}"
        chart_ref: "{{ package_info['package']['chart_ref'] }}"
        chart_version: "{{ package_info['package']['chart_version'] }}"
        values: "{{ package_info['package']['values'] }}"
        update_repo_cache: true
        create_namespace: true
        wait: true
