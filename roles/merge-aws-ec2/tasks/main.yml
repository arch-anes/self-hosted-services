- name: Get host public IP
  ipify_facts:

- name: Set facts
  set_fact:
    advertised_address: "{{ipify_public_ip}}:2377"
    swarm_labels:
      - small

- name: Add AWS hosts to Docker Swarm Managers
  add_host:
    groups: docker_swarm_manager
    hostname: "{{item}}"
    inventory_dir: "{{ hostvars[item].inventory_dir }}"
  when: ("ram0" not in hostvars[item].ansible_devices)
  with_items: "{{ groups.aws_ec2 }}"
