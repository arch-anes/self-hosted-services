# code: language=ansible
---

- name: Fix DNS resolution issue
  become: true
  when: ansible_distribution == 'Ubuntu'
  block:
    - name: Write DNS resolution config
      ansible.builtin.lineinfile:
        line: nameserver 1.1.1.1
        dest: /etc/resolvconf/resolv.conf.d/head

    - name: Start DNS configuration manager service
      ansible.builtin.service:
        name: resolvconf
        state: started

    - name: Update /etc/resolv.conf
      ansible.builtin.command: "/usr/sbin/resolvconf -u"
      changed_when: false
