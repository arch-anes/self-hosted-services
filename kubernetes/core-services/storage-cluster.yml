---
apiVersion: v1
kind: Namespace
metadata:
  name: storage-cluster

---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: storage-cluster
  namespace: kube-system
spec:
  chart: rook-ceph-cluster
  repo: https://charts.rook.io/release
  version: 1.12.1
  targetNamespace: storage-cluster
  valuesContent: |-
    pspEnable: true
    clusterName: storage-cluster
    cephClusterSpec:
      cephVersion:
        image: quay.io/ceph/ceph:v17.2.6
      dataDirHostPath: /storage/cluster
      mon:
        count: 2
        allowMultiplePerNode: false
      dashboard:
        enabled: true
      storage:
        useAllNodes: true
        useAllDevices: true
        deviceFilter: /dev/mapper/cstorage

---
apiVersion: ceph.rook.io/v1
kind: CephBlockPool
metadata:
  name: storage-cluster
  namespace: storage-cluster
spec:
  failureDomain: host
  replicated:
    size: 3

---
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
   name: storage-cluster-block
provisioner: rook-ceph.rbd.csi.ceph.com
reclaimPolicy: Delete
allowVolumeExpansion: true
parameters:
    clusterID: storage-cluster
    pool: storage-cluster
    imageFeatures: layering
    csi.storage.k8s.io/provisioner-secret-name: rook-csi-rbd-provisioner
    csi.storage.k8s.io/provisioner-secret-namespace: storage-cluster
    csi.storage.k8s.io/controller-expand-secret-name: rook-csi-rbd-provisioner
    csi.storage.k8s.io/controller-expand-secret-namespace: storage-cluster
    csi.storage.k8s.io/node-stage-secret-name: rook-csi-rbd-node
    csi.storage.k8s.io/node-stage-secret-namespace: storage-cluster
