---
apiVersion: v1
kind: Secret
metadata:
  name: keel
  namespace: kube-system
type: Opaque
# stringData:
#   BASIC_AUTH_USER: "admin"
#   BASIC_AUTH_PASSWORD: "somepasswd"
#   MAIL_SMTP_SERVER: "example.com"
#   MAIL_SMTP_PORT: "587"
#   MAIL_SMTP_USER: "exampleuser"
#   MAIL_SMTP_PASS: "examplepassword"
#   MAIL_TO: "hello@example.com"

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: keel
  namespace: kube-system
spec:
  tls:
    - hosts:
        - keel.${DOMAIN_NAME}
      secretName: wilcard-main-domain-tls
  rules:
    - host: keel.${DOMAIN_NAME}
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: keel
                port:
                  name: keel

---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: keel
  namespace: kube-system
spec:
  chart: keel
  repo: https://charts.keel.sh
  version: 1.0.2
  targetNamespace: kube-system
  valuesContent: |-
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 50m
        memory: 64Mi
    image:
      repository: keelhq/keel
      tag: latest
    helmProvider:
      enabled: true
      version: "v3"
    secret:
      name: keel
      create: false
    basicauth:
      enabled: true
      user: admin
      password: password
    mail:
      enabled: true
      from: keel@${DOMAIN_NAME}
    service:
      enabled: true
      type: ClusterIP
      externalPort: 9300
    keel:
      policy: all
      trigger: poll
      pollSchedule: "@weekly"
