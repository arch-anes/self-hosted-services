---
- name: Setup hosts
  hosts: all
  become: yes

  roles:
    - role: weareinteractive.ufw
      vars:
        ufw_reset: no
        ufw_rules:
          - { port: 22, proto: tcp, rule: limit, comment: "Limit SSH" }
          - { port: 80, proto: tcp, rule: allow, comment: "Allow HTTP" }
          - { port: 443, proto: tcp, rule: allow, comment: "Allow HTTPS" }
          - { port: 53, proto: any, rule: allow, comment: "Allow DNS" }
          - { port: 2377, proto: tcp, rule: allow, comment: "Allow Docker Swarm cluster management communications" }
          - { port: 7946, proto: any, rule: allow, comment: "Allow communication among Docker Swarm nodes" }
          - { port: 4789, proto: udp, rule: allow, comment: "Allow Docker Swarm overlay network traffic" }
          - { port: 22000, proto: tcp, rule: allow, comment: "Allow Syncthing" }
          - { port: 21027, proto: udp, rule: allow, comment: "Allow Syncthing discovery broadcast" }

    - role: atosatto.docker-swarm
      vars:
        skip_repo: true
        skip_containerd: true
        skip_engine: true
        skip_cli: true
        skip_group: true
        skip_docker_py: true
        skip_docker_compose: true
